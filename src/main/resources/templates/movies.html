<!DOCTYPE HTML>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorator="default">

<body>
    <div layout:fragment="content" class="row">
        <div class="col-xs-8 col-md-8" align="center">
            <div id="searchResults" th:if="${total_num_entries > 0}">
				<div class="content container has-text-centered" th:with="entry_starting_index=${entries_per_page * page}">
					<h6 style="color: black;">
						<span>Showing</span>
						<span th:text="${entry_starting_index+1}"></span>
						<span> - </span>
						<span th:with="entry_closing_index=${entry_starting_index + entries_per_page}">
							<span th:unless="${entry_closing_index > total_num_entries}" th:text="${entry_closing_index}"></span>
							<span th:if="${entry_closing_index > total_num_entries}" th:text="${total_num_entries}"></span>
						</span>
						<span>of</span>
						<span th:text="${total_num_entries}"></span>
						<span>results</span>
						<span th:unless="${#strings.isEmpty(textSearch)}">for
							<span th:text="${textSearch}"></span>
						</span>
						<span th:unless="${#strings.isEmpty(genres)}">in the
							<span th:text="${genres}"></span> genre
						</span>
						<span th:if="${#strings.isEmpty(genres) and #strings.isEmpty(textSearch)}">for all movies</span>
					</h6>
				</div>
            </div>
            
			<div class="columns is-multiline" th:if="${not #lists.isEmpty(movies)}" style="overflow-y: auto; height: 445px; width:1295px;">
				<div th:each="movie : ${movies}" class="column is-3-desktop is-6-tablet content has-text-centered">
					<div class="box has-text-centered" style="height: 570px;">
						<a th:href="@{'/movie?id=' + ${movie.id}}" style="text-decoration: none; display: block; width: 100%; height: 100%;">
							<div style="height: 400px">
								<img class="movie-image" th:src="${!#strings.isEmpty(movie.poster) ? movie.poster : 'http://www.reelviews.net/resources/img/default_poster.jpg'}" 
								alt="No movie image found."/>
							</div>
							<h4 style="margin-top: 15px; color: #6aaf4e; height: 45px;" th:text="${#strings.abbreviate(movie.title,57)}"></h4>
							
							<p>
								<span class="tag is-rounded" th:text="${movie.year}" style="color: #f2f2f2;"></span>
								<span class="tag is-rounded is-warning" th:text="${movie.rated}"></span>
							</p>
							
							<h6 th:unless="${#strings.isEmpty(movie.castString)}">Starring
								<span th:text="${#strings.abbreviate(movie.castString,70)}"></span>
							</h6>
							<h6 th:if="${#strings.isEmpty(movie.castString)}">&nbsp;</h6>
							
							<div style="color: #f2f2f2;" th:with="RATING_NAME=${'IMDB'},CONDENSED_RATING=${true},
							VALID_RATING=${#strings.isEmpty(movie.imdb.rating) ? false : true}">
								<div th:with="MAX_RATING=${10},rating=${movie.imdb.rating}" th:if="${VALID_RATING}"
								th:include="partials/ratingbar"/>
								<div th:unless="${VALID_RATING}">
									<p>No IMDB ratings available.</p>
								</div>
							</div>
						</a>
					</div>
				</div>
			</div>
			<div style="background-color:#222222;" class="container content has-text-centered" th:unless="${not #lists.isEmpty(movies)}"
			th:include="partials/noMovie"/>
			
			<hr style="margin:0px;"/>
			
			<div class="has-text-centered">
				<h6 style="margin-top:  0px;margin-bottom: 5px;">Filter By Genre</h6>
				<a th:each="genre: ${all_genres}" class="tag button is-small is-dark" 
				th:classappend="${!#strings.isEmpty(genres) and genres==genre ? 'genre-selected' :''}" 
				th:text="${genre}" th:href="${'/movies?genres='+genre}" style="margin: 3px 2px;"/>
			</div>
			
			<nav class="pagination" style="margin-top:-43px;">
				<a th:if="${previous_page != null and page > 0}" class="pagination-previous" th:href="@{'/movies?' + ${previous_page}}">Previous Page</a>
				<a th:unless="${previous_page != null and page > 0}" class="pagination-previous" disabled="disabled">Previous Page</a>
				<a th:unless="${next_page != null and ((page + 1) * entries_per_page) >= total_num_entries}" class="pagination-next" th:href="@{'/movies?' + ${next_page}}">Next Page</a>
				<a th:if="${next_page != null and ((page + 1) * entries_per_page) >= total_num_entries}" class="pagination-next" disabled="disabled">Next Page</a>
			</nav>
        </div>
    </div>
</body>

</html>